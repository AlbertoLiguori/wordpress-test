!function(a,b){"object"==typeof exports&&"undefined"!=typeof module?b(exports):"function"==typeof define&&define.amd?define(["exports"],b):b((a.Leaflet=a.Leaflet||{},a.Leaflet.markercluster=a.Leaflet.markercluster||{}))}(this,function(a){"use strict";var b=L.MarkerClusterGroup=L.FeatureGroup.extend({options:{maxClusterRadius:80,iconCreateFunction:null,clusterPane:L.Marker.prototype.options.pane,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,singleMarkerMode:!1,disableClusteringAtZoom:null,removeOutsideVisibleBounds:!0,animate:!0,animateAddingMarkers:!1,spiderfyDistanceMultiplier:1,spiderLegPolylineOptions:{weight:1.5,color:"#222",opacity:.5},chunkedLoading:!1,chunkInterval:200,chunkDelay:50,chunkProgress:null,polygonOptions:{}},initialize:function(b){L.Util.setOptions(this,b),this.options.iconCreateFunction||(this.options.iconCreateFunction=this._defaultIconCreateFunction),this._featureGroup=L.featureGroup(),this._featureGroup.addEventParent(this),this._nonPointGroup=L.featureGroup(),this._nonPointGroup.addEventParent(this),this._inZoomAnimation=0,this._needsClustering=[],this._needsRemoving=[],this._currentShownBounds=null,this._queue=[],this._childMarkerEventHandlers={dragstart:this._childMarkerDragStart,move:this._childMarkerMoved,dragend:this._childMarkerDragEnd};var a=L.DomUtil.TRANSITION&&this.options.animate;L.extend(this,a?this._withAnimation:this._noAnimation),this._markerCluster=a?L.MarkerCluster:L.MarkerClusterNonAnimated},addLayer:function(a){if(a instanceof L.LayerGroup)return this.addLayers([a]);if(!a.getLatLng)return this._nonPointGroup.addLayer(a),this.fire("layeradd",{layer:a}),this;if(!this._map)return this._needsClustering.push(a),this.fire("layeradd",{layer:a}),this;if(this.hasLayer(a))return this;this._unspiderfy&&this._unspiderfy(),this._addLayer(a,this._maxZoom),this.fire("layeradd",{layer:a}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons();var b=a,c=this._zoom;if(a.__parent)for(;b.__parent._zoom>=c;)b=b.__parent;return this._currentShownBounds.contains(b.getLatLng())&&(this.options.animateAddingMarkers?this._animationAddLayer(a,b):this._animationAddLayerNonAnimated(a,b)),this},removeLayer:function(a){return a instanceof L.LayerGroup?this.removeLayers([a]):a.getLatLng?this._map?a.__parent?(this._unspiderfy&&(this._unspiderfy(),this._unspiderfyLayer(a)),this._removeLayer(a,!0),this.fire("layerremove",{layer:a}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),a.off(this._childMarkerEventHandlers,this),this._featureGroup.hasLayer(a)&&(this._featureGroup.removeLayer(a),a.clusterShow&&a.clusterShow()),this):this:(!this._arraySplice(this._needsClustering,a)&&this.hasLayer(a)&&this._needsRemoving.push({layer:a,latlng:a._latlng}),this.fire("layerremove",{layer:a}),this):(this._nonPointGroup.removeLayer(a),this.fire("layerremove",{layer:a}),this)},addLayers:function(b,m){var a,k,g,j,i,h,d,c,e,l,f,n;if(!L.Util.isArray(b))return this.addLayer(b);if(k=this._featureGroup,g=this._nonPointGroup,j=this.options.chunkedLoading,i=this.options.chunkInterval,h=this.options.chunkProgress,d=b.length,c=0,e=!0,this._map)l=(new Date).getTime(),f=L.bind(function(){for(var o=(new Date).getTime(),p,n,q;d>c;c++){if(j&&0===c%200)if(p=(new Date).getTime()-o,p>i)break;a=b[c],a instanceof L.LayerGroup?(e&&(b=b.slice(),e=!1),this._extractNonGroupLayers(a,b),d=b.length):a.getLatLng?!this.hasLayer(a)&&(this._addLayer(a,this._maxZoom),m||this.fire("layeradd",{layer:a}),a.__parent&&2===a.__parent.getChildCount())&&(n=a.__parent.getAllChildMarkers(),q=n[0]===a?n[1]:n[0],k.removeLayer(q)):(g.addLayer(a),m||this.fire("layeradd",{layer:a}))}h&&h(c,d,(new Date).getTime()-l),c===d?(this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)):setTimeout(f,this.options.chunkDelay)},this),f();else for(n=this._needsClustering;d>c;c++)a=b[c],a instanceof L.LayerGroup?(e&&(b=b.slice(),e=!1),this._extractNonGroupLayers(a,b),d=b.length):a.getLatLng?this.hasLayer(a)||n.push(a):g.addLayer(a);return this},removeLayers:function(b){var c,a,d=b.length,g=this._featureGroup,h=this._nonPointGroup,e=!0,f,i;if(!this._map){for(c=0;d>c;c++)a=b[c],a instanceof L.LayerGroup?(e&&(b=b.slice(),e=!1),this._extractNonGroupLayers(a,b),d=b.length):(this._arraySplice(this._needsClustering,a),h.removeLayer(a),this.hasLayer(a)&&this._needsRemoving.push({layer:a,latlng:a._latlng}),this.fire("layerremove",{layer:a}));return this}if(this._unspiderfy){this._unspiderfy(),f=b.slice(),i=d;for(c=0;i>c;c++)a=f[c],a instanceof L.LayerGroup?(this._extractNonGroupLayers(a,f),i=f.length):this._unspiderfyLayer(a)}for(c=0;d>c;c++)a=b[c],a instanceof L.LayerGroup?(e&&(b=b.slice(),e=!1),this._extractNonGroupLayers(a,b),d=b.length):a.__parent?(this._removeLayer(a,!0,!0),this.fire("layerremove",{layer:a}),g.hasLayer(a)&&(g.removeLayer(a),a.clusterShow&&a.clusterShow())):(h.removeLayer(a),this.fire("layerremove",{layer:a}));return this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds),this},clearLayers:function(){return this._map||(this._needsClustering=[],this._needsRemoving=[],delete this._gridClusters,delete this._gridUnclustered),this._noanimationUnspiderfy&&this._noanimationUnspiderfy(),this._featureGroup.clearLayers(),this._nonPointGroup.clearLayers(),this.eachLayer(function(a){a.off(this._childMarkerEventHandlers,this),delete a.__parent},this),this._map&&this._generateInitialClusters(),this},getBounds:function(){var a=new L.LatLngBounds,b;this._topClusterLevel&&a.extend(this._topClusterLevel._bounds);for(b=this._needsClustering.length-1;b>=0;b--)a.extend(this._needsClustering[b].getLatLng());return a.extend(this._nonPointGroup.getBounds()),a},eachLayer:function(e,f){var d,a,b,c=this._needsClustering.slice(),g=this._needsRemoving;for(this._topClusterLevel&&this._topClusterLevel.getAllChildMarkers(c),a=c.length-1;a>=0;a--){for(d=!0,b=g.length-1;b>=0;b--)if(g[b].layer===c[a]){d=!1;break}d&&e.call(f,c[a])}this._nonPointGroup.eachLayer(e,f)},getLayers:function(){var a=[];return this.eachLayer(function(b){a.push(b)}),a},getLayer:function(a){var b=null;return a=parseInt(a,10),this.eachLayer(function(c){L.stamp(c)===a&&(b=c)}),b},hasLayer:function(b){if(!b)return!1;var a,c=this._needsClustering;for(a=c.length-1;a>=0;a--)if(c[a]===b)return!0;for(c=this._needsRemoving,a=c.length-1;a>=0;a--)if(c[a].layer===b)return!1;return!(!b.__parent||b.__parent._group!==this)||this._nonPointGroup.hasLayer(b)},zoomToShowLayer:function(a,b){"function"!=typeof b&&(b=function(){});var c=function(){!a._icon&&!a.__parent._icon||this._inZoomAnimation||(this._map.off("moveend",c,this),this.off("animationend",c,this),a._icon?b():a.__parent._icon&&(this.once("spiderfied",b,this),a.__parent.spiderfy()))};a._icon&&this._map.getBounds().contains(a.getLatLng())?b():a.__parent._zoom<Math.round(this._map._zoom)?(this._map.on("moveend",c,this),this._map.panTo(a.getLatLng())):(this._map.on("moveend",c,this),this.on("animationend",c,this),a.__parent.zoomToBounds())},onAdd:function(d){this._map=d;var b,c,a;if(!isFinite(this._map.getMaxZoom()))throw"Map has no maxZoom specified";for(this._featureGroup.addTo(d),this._nonPointGroup.addTo(d),this._gridClusters||this._generateInitialClusters(),this._maxLat=d.options.crs.projection.MAX_LATITUDE,b=0,c=this._needsRemoving.length;c>b;b++)a=this._needsRemoving[b],a.newlatlng=a.layer._latlng,a.layer._latlng=a.latlng;for(b=0,c=this._needsRemoving.length;c>b;b++)a=this._needsRemoving[b],this._removeLayer(a.layer,!0),a.layer._latlng=a.newlatlng;this._needsRemoving=[],this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds(),this._map.on("zoomend",this._zoomEnd,this),this._map.on("moveend",this._moveEnd,this),this._spiderfierOnAdd&&this._spiderfierOnAdd(),this._bindEvents(),c=this._needsClustering,this._needsClustering=[],this.addLayers(c,!0)},onRemove:function(a){a.off("zoomend",this._zoomEnd,this),a.off("moveend",this._moveEnd,this),this._unbindEvents(),this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim",""),this._spiderfierOnRemove&&this._spiderfierOnRemove(),delete this._maxLat,this._hideCoverage(),this._featureGroup.remove(),this._nonPointGroup.remove(),this._featureGroup.clearLayers(),this._map=null},getVisibleParent:function(b){for(var a=b;a&&!a._icon;)a=a.__parent;return a||null},_arraySplice:function(b,c){for(var a=b.length-1;a>=0;a--)if(b[a]===c)return b.splice(a,1),!0},_removeFromGridUnclustered:function(b,a){for(var c=this._map,d=this._gridUnclustered,e=Math.floor(this._map.getMinZoom());a>=e&&d[a].removeObject(b,c.project(b.getLatLng(),a));a--);},_childMarkerDragStart:function(a){a.target.__dragStart=a.target._latlng},_childMarkerMoved:function(a){if(!this._ignoreMove&&!a.target.__dragStart){var b=a.target._popup&&a.target._popup.isOpen();this._moveChild(a.target,a.oldLatLng,a.latlng),b&&a.target.openPopup()}},_moveChild:function(a,b,c){a._latlng=b,this.removeLayer(a),a._latlng=c,this.addLayer(a)},_childMarkerDragEnd:function(a){var b=a.target.__dragStart;delete a.target.__dragStart,b&&this._moveChild(a.target,b,a.target._latlng)},_removeLayer:function(c,d,i){var j=this._gridClusters,g=this._gridUnclustered,e=this._featureGroup,f=this._map,h=Math.floor(this._map.getMinZoom()),b,a,k;d&&this._removeFromGridUnclustered(c,this._maxZoom),a=c.__parent,k=a._markers;for(this._arraySplice(k,c);a&&(a._childCount--,a._boundsNeedUpdate=!0,!(a._zoom<h));)d&&a._childCount<=1?(b=a._markers[0]===c?a._markers[1]:a._markers[0],j[a._zoom].removeObject(a,f.project(a._cLatLng,a._zoom)),g[a._zoom].addObject(b,f.project(b.getLatLng(),a._zoom)),this._arraySplice(a.__parent._childClusters,a),a.__parent._markers.push(b),b.__parent=a.__parent,a._icon&&(e.removeLayer(a),i||e.addLayer(b))):a._iconNeedsUpdate=!0,a=a.__parent;delete c.__parent},_isOrIsParent:function(b,a){for(;a;){if(b===a)return!0;a=a.parentNode}return!1},fire:function(b,a,c){if(a&&a.layer instanceof L.MarkerCluster){if(a.originalEvent&&this._isOrIsParent(a.layer._icon,a.originalEvent.relatedTarget))return;b="cluster"+b}L.FeatureGroup.prototype.fire.call(this,b,a,c)},listens:function(a,b){return L.FeatureGroup.prototype.listens.call(this,a,b)||L.FeatureGroup.prototype.listens.call(this,"cluster"+a,b)},_defaultIconCreateFunction:function(c){var a=c.getChildCount(),b=" marker-cluster-";return b+=10>a?"small":100>a?"medium":"large",new L.DivIcon({html:"<div><span>"+a+"</span></div>",className:"marker-cluster"+b,iconSize:new L.Point(40,40)})},_bindEvents:function(){var a=this._map,b=this.options.spiderfyOnMaxZoom,c=this.options.showCoverageOnHover,d=this.options.zoomToBoundsOnClick;(b||d)&&this.on("clusterclick",this._zoomOrSpiderfy,this),c&&(this.on("clustermouseover",this._showCoverage,this),this.on("clustermouseout",this._hideCoverage,this),a.on("zoomend",this._hideCoverage,this))},_zoomOrSpiderfy:function(c){for(var b=c.layer,a=b;1===a._childClusters.length;)a=a._childClusters[0];a._zoom===this._maxZoom&&a._childCount===b._childCount&&this.options.spiderfyOnMaxZoom?b.spiderfy():this.options.zoomToBoundsOnClick&&b.zoomToBounds(),c.originalEvent&&13===c.originalEvent.keyCode&&this._map._container.focus()},_showCoverage:function(a){var b=this._map;this._inZoomAnimation||(this._shownPolygon&&b.removeLayer(this._shownPolygon),a.layer.getChildCount()>2&&a.layer!==this._spiderfied&&(this._shownPolygon=new L.Polygon(a.layer.getConvexHull(),this.options.polygonOptions),b.addLayer(this._shownPolygon)))},_hideCoverage:function(){this._shownPolygon&&(this._map.removeLayer(this._shownPolygon),this._shownPolygon=null)},_unbindEvents:function(){var a=this.options.spiderfyOnMaxZoom,b=this.options.showCoverageOnHover,c=this.options.zoomToBoundsOnClick,d=this._map;(a||c)&&this.off("clusterclick",this._zoomOrSpiderfy,this),b&&(this.off("clustermouseover",this._showCoverage,this),this.off("clustermouseout",this._hideCoverage,this),d.off("zoomend",this._hideCoverage,this))},_zoomEnd:function(){this._map&&(this._mergeSplitClusters(),this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds())},_moveEnd:function(){if(!this._inZoomAnimation){var a=this._getExpandedVisibleBounds();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),this._zoom,a),this._topClusterLevel._recursivelyAddChildrenToMap(null,Math.round(this._map._zoom),a),this._currentShownBounds=a}},_generateInitialClusters:function(){var b=Math.ceil(this._map.getMaxZoom()),e=Math.floor(this._map.getMinZoom()),c=this.options.maxClusterRadius,d=c,a;"function"!=typeof c&&(d=function(){return c}),null!==this.options.disableClusteringAtZoom&&(b=this.options.disableClusteringAtZoom-1),this._maxZoom=b,this._gridClusters={},this._gridUnclustered={};for(a=b;a>=e;a--)this._gridClusters[a]=new L.DistanceGrid(d(a)),this._gridUnclustered[a]=new L.DistanceGrid(d(a));this._topClusterLevel=new this._markerCluster(this,e-1)},_addLayer:function(b,a){var f,d,i=this._gridClusters,j=this._gridUnclustered,k=Math.floor(this._map.getMinZoom()),c,h,e,g;for(this.options.singleMarkerMode&&this._overrideMarkerIcon(b),b.on(this._childMarkerEventHandlers,this);a>=k;a--){if(f=this._map.project(b.getLatLng(),a),c=i[a].getNearObject(f),c)return c._addChild(b),b.__parent=c,void 0;if(c=j[a].getNearObject(f)){h=c.__parent,h&&this._removeLayer(c,!1),e=new this._markerCluster(this,a,c,b),i[a].addObject(e,this._map.project(e._cLatLng,a)),c.__parent=e,b.__parent=e,g=e;for(d=a-1;d>h._zoom;d--)g=new this._markerCluster(this,d,g),i[d].addObject(g,this._map.project(c.getLatLng(),d));return h._addChild(g),this._removeFromGridUnclustered(c,a),void 0}j[a].addObject(b,f)}this._topClusterLevel._addChild(b),b.__parent=this._topClusterLevel},_refreshClustersIcons:function(){this._featureGroup.eachLayer(function(a){a instanceof L.MarkerCluster&&a._iconNeedsUpdate&&a._updateIcon()})},_enqueue:function(a){this._queue.push(a),this._queueTimeout||(this._queueTimeout=setTimeout(L.bind(this._processQueue,this),300))},_processQueue:function(){for(var a=0;a<this._queue.length;a++)this._queue[a].call(this);this._queue.length=0,clearTimeout(this._queueTimeout),this._queueTimeout=null},_mergeSplitClusters:function(){var a=Math.round(this._map._zoom);this._processQueue(),this._zoom<a&&this._currentShownBounds.intersects(this._getExpandedVisibleBounds())?(this._animationStart(),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),this._zoom,this._getExpandedVisibleBounds()),this._animationZoomIn(this._zoom,a)):this._zoom>a?(this._animationStart(),this._animationZoomOut(this._zoom,a)):this._moveEnd()},_getExpandedVisibleBounds:function(){return this.options.removeOutsideVisibleBounds?L.Browser.mobile?this._checkBoundsMaxLat(this._map.getBounds()):this._checkBoundsMaxLat(this._map.getBounds().pad(1)):this._mapBoundsInfinite},_checkBoundsMaxLat:function(a){var b=this._maxLat;return void 0!==b&&(a.getNorth()>=b&&(a._northEast.lat=1/0),a.getSouth()<=-b&&(a._southWest.lat=-1/0)),a},_animationAddLayerNonAnimated:function(b,a){if(a===b)this._featureGroup.addLayer(b);else if(2===a._childCount){a._addToMap();var c=a.getAllChildMarkers();this._featureGroup.removeLayer(c[0]),this._featureGroup.removeLayer(c[1])}else a._updateIcon()},_extractNonGroupLayers:function(e,a){var b,d=e.getLayers(),c=0;for(a=a||[];c<d.length;c++)b=d[c],b instanceof L.LayerGroup?this._extractNonGroupLayers(b,a):a.push(b);return a},_overrideMarkerIcon:function(a){var b=a.options.icon=this.options.iconCreateFunction({getChildCount:function(){return 1},getAllChildMarkers:function(){return[a]}});return b}}),c;L.MarkerClusterGroup.include({_mapBoundsInfinite:new L.LatLngBounds(new L.LatLng(-1/0,-1/0),new L.LatLng(1/0,1/0))}),L.MarkerClusterGroup.include({_noAnimation:{_animationStart:function(){},_animationZoomIn:function(a,b){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),a),this._topClusterLevel._recursivelyAddChildrenToMap(null,b,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationZoomOut:function(a,b){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),a),this._topClusterLevel._recursivelyAddChildrenToMap(null,b,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationAddLayer:function(a,b){this._animationAddLayerNonAnimated(a,b)}},_withAnimation:{_animationStart:function(){this._map._mapPane.className+=" leaflet-cluster-anim",this._inZoomAnimation++},_animationZoomIn:function(c,b){var d,a=this._getExpandedVisibleBounds(),e=this._featureGroup,f=Math.floor(this._map.getMinZoom());this._ignoreMove=!0,this._topClusterLevel._recursively(a,c,f,function(f){var g,h=f._latlng,i=f._markers;for(a.contains(h)||(h=null),f._isSingleParent()&&c+1===b?(e.removeLayer(f),f._recursivelyAddChildrenToMap(null,b,a)):(f.clusterHide(),f._recursivelyAddChildrenToMap(h,b,a)),d=i.length-1;d>=0;d--)g=i[d],a.contains(g._latlng)||e.removeLayer(g)}),this._forceLayout(),this._topClusterLevel._recursivelyBecomeVisible(a,b),e.eachLayer(function(a){a instanceof L.MarkerCluster||!a._icon||a.clusterShow()}),this._topClusterLevel._recursively(a,c,b,function(a){a._recursivelyRestoreChildPositions(b)}),this._ignoreMove=!1,this._enqueue(function(){this._topClusterLevel._recursively(a,c,f,function(a){e.removeLayer(a),a.clusterShow()}),this._animationEnd()})},_animationZoomOut:function(a,b){this._animationZoomOutSingle(this._topClusterLevel,a-1,b),this._topClusterLevel._recursivelyAddChildrenToMap(null,b,this._getExpandedVisibleBounds()),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),a,this._getExpandedVisibleBounds())},_animationAddLayer:function(a,b){var c=this,d=this._featureGroup;d.addLayer(a),b!==a&&(b._childCount>2?(b._updateIcon(),this._forceLayout(),this._animationStart(),a._setPos(this._map.latLngToLayerPoint(b.getLatLng())),a.clusterHide(),this._enqueue(function(){d.removeLayer(a),a.clusterShow(),c._animationEnd()})):(this._forceLayout(),c._animationStart(),c._animationZoomOutSingle(b,this._map.getMaxZoom(),this._zoom)))}},_animationZoomOutSingle:function(a,e,c){var b=this._getExpandedVisibleBounds(),d=Math.floor(this._map.getMinZoom()),f;a._recursivelyAnimateChildrenInAndAddSelfToMap(b,d,e+1,c),f=this,this._forceLayout(),a._recursivelyBecomeVisible(b,c),this._enqueue(function(){if(1===a._childCount){var g=a._markers[0];this._ignoreMove=!0,g.setLatLng(g.getLatLng()),this._ignoreMove=!1,g.clusterShow&&g.clusterShow()}else a._recursively(b,c,d,function(a){a._recursivelyRemoveChildrenFromMap(b,d,e+1)});f._animationEnd()})},_animationEnd:function(){this._map&&(this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim","")),this._inZoomAnimation--,this.fire("animationend")},_forceLayout:function(){L.Util.falseFn(document.body.offsetWidth)}}),L.markerClusterGroup=function(a){return new L.MarkerClusterGroup(a)},c=L.MarkerCluster=L.Marker.extend({options:L.Icon.prototype.options,initialize:function(b,d,a,c){L.Marker.prototype.initialize.call(this,a?a._cLatLng||a.getLatLng():new L.LatLng(0,0),{icon:this,pane:b.options.clusterPane}),this._group=b,this._zoom=d,this._markers=[],this._childClusters=[],this._childCount=0,this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._bounds=new L.LatLngBounds,a&&this._addChild(a),c&&this._addChild(c)},getAllChildMarkers:function(a,d){var c,b;a=a||[];for(c=this._childClusters.length-1;c>=0;c--)this._childClusters[c].getAllChildMarkers(a);for(b=this._markers.length-1;b>=0;b--)d&&this._markers[b].__dragStart||a.push(this._markers[b]);return a},getChildCount:function(){return this._childCount},zoomToBounds:function(h){for(var a,b=this._childClusters.slice(),g=this._group._map,d=g.getBoundsZoom(this._bounds),c=this._zoom+1,f=g.getZoom(),e;b.length>0&&d>c;){c++,e=[];for(a=0;a<b.length;a++)e=e.concat(b[a]._childClusters);b=e}d>c?this._group._map.setView(this._latlng,c):f>=d?this._group._map.setView(this._latlng,f+1):this._group._map.fitBounds(this._bounds,h)},getBounds:function(){var a=new L.LatLngBounds;return a.extend(this._bounds),a},_updateIcon:function(){this._iconNeedsUpdate=!0,this._icon&&this.setIcon(this)},createIcon:function(){return this._iconNeedsUpdate&&(this._iconObj=this._group.options.iconCreateFunction(this),this._iconNeedsUpdate=!1),this._iconObj.createIcon()},createShadow:function(){return this._iconObj.createShadow()},_addChild:function(a,b){this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._setClusterCenter(a),a instanceof L.MarkerCluster?(b||(this._childClusters.push(a),a.__parent=this),this._childCount+=a._childCount):(b||this._markers.push(a),this._childCount++),this.__parent&&this.__parent._addChild(a,!0)},_setClusterCenter:function(a){this._cLatLng||(this._cLatLng=a._cLatLng||a._latlng)},_resetBounds:function(){var a=this._bounds;a._southWest&&(a._southWest.lat=1/0,a._southWest.lng=1/0),a._northEast&&(a._northEast.lat=-1/0,a._northEast.lng=-1/0)},_recalculateBounds:function(){var a,c,b,d,h=this._markers,i=this._childClusters,e=0,f=0,g=this._childCount;if(0!==g){for(this._resetBounds(),a=0;a<h.length;a++)b=h[a]._latlng,this._bounds.extend(b),e+=b.lat,f+=b.lng;for(a=0;a<i.length;a++)c=i[a],c._boundsNeedUpdate&&c._recalculateBounds(),this._bounds.extend(c._bounds),b=c._wLatLng,d=c._childCount,e+=b.lat*d,f+=b.lng*d;this._latlng=this._wLatLng=new L.LatLng(e/g,f/g),this._boundsNeedUpdate=!1}},_addToMap:function(a){a&&(this._backupLatlng=this._latlng,this.setLatLng(a)),this._group._featureGroup.addLayer(this)},_recursivelyAnimateChildrenIn:function(b,a,c){this._recursively(b,this._group._map.getMinZoom(),c-1,function(e){var b,c,d=e._markers;for(b=d.length-1;b>=0;b--)c=d[b],c._icon&&(c._setPos(a),c.clusterHide())},function(e){var b,c,d=e._childClusters;for(b=d.length-1;b>=0;b--)c=d[b],c._icon&&(c._setPos(a),c.clusterHide())})},_recursivelyAnimateChildrenInAndAddSelfToMap:function(a,c,b,d){this._recursively(a,d,c,function(e){e._recursivelyAnimateChildrenIn(a,e._group._map.latLngToLayerPoint(e.getLatLng()).round(),b),e._isSingleParent()&&b-1===d?(e.clusterShow(),e._recursivelyRemoveChildrenFromMap(a,c,b)):e.clusterHide(),e._addToMap()})},_recursivelyBecomeVisible:function(a,b){this._recursively(a,this._group._map.getMinZoom(),b,null,function(a){a.clusterShow()})},_recursivelyAddChildrenToMap:function(a,b,c){this._recursively(c,this._group._map.getMinZoom()-1,b,function(e){var f,d;if(b!==e._zoom)for(f=e._markers.length-1;f>=0;f--)d=e._markers[f],c.contains(d._latlng)&&(a&&(d._backupLatlng=d.getLatLng(),d.setLatLng(a),d.clusterHide&&d.clusterHide()),e._group._featureGroup.addLayer(d))},function(b){b._addToMap(a)})},_recursivelyRestoreChildPositions:function(e){for(var b=this._markers.length-1,a,c,d;b>=0;b--)a=this._markers[b],a._backupLatlng&&(a.setLatLng(a._backupLatlng),delete a._backupLatlng);if(e-1===this._zoom)for(c=this._childClusters.length-1;c>=0;c--)this._childClusters[c]._restorePosition();else for(d=this._childClusters.length-1;d>=0;d--)this._childClusters[d]._recursivelyRestoreChildPositions(e)},_restorePosition:function(){this._backupLatlng&&(this.setLatLng(this._backupLatlng),delete this._backupLatlng)},_recursivelyRemoveChildrenFromMap:function(d,e,f,c){var a,b;this._recursively(d,e-1,f-1,function(d){for(b=d._markers.length-1;b>=0;b--)a=d._markers[b],c&&c.contains(a._latlng)||(d._group._featureGroup.removeLayer(a),a.clusterShow&&a.clusterShow())},function(d){for(b=d._childClusters.length-1;b>=0;b--)a=d._childClusters[b],c&&c.contains(a._latlng)||(d._group._featureGroup.removeLayer(a),a.clusterShow&&a.clusterShow())})},_recursively:function(h,d,g,e,f){var c,a,i=this._childClusters,b=this._zoom;if(b>=d&&(e&&e(this),f&&b===g&&f(this)),d>b||g>b)for(c=i.length-1;c>=0;c--)a=i[c],a._boundsNeedUpdate&&a._recalculateBounds(),h.intersects(a._bounds)&&a._recursively(h,d,g,e,f)},_isSingleParent:function(){return this._childClusters.length>0&&this._childClusters[0]._childCount===this._childCount}}),L.Marker.include({clusterHide:function(){var a=this.options.opacity;return this.setOpacity(0),this.options.opacity=a,this},clusterShow:function(){return this.setOpacity(this.options.opacity)}}),L.DistanceGrid=function(a){this._cellSize=a,this._sqCellSize=a*a,this._grid={},this._objectPoint={}},L.DistanceGrid.prototype={addObject:function(b,a){var c=this._getCoord(a.x),d=this._getCoord(a.y),e=this._grid,f=e[d]=e[d]||{},g=f[c]=f[c]||[],h=L.Util.stamp(b);this._objectPoint[h]=a,g.push(b)},updateObject:function(a,b){this.removeObject(a),this.addObject(a,b)},removeObject:function(f,i){var a,c,d=this._getCoord(i.x),g=this._getCoord(i.y),h=this._grid,b=h[g]=h[g]||{},e=b[d]=b[d]||[];for(delete this._objectPoint[L.Util.stamp(f)],a=0,c=e.length;c>a;a++)if(e[a]===f)return e.splice(a,1),1===c&&delete b[d],!0},eachObject:function(i,j){var e,f,a,d,b,c,g,h=this._grid;for(e in h){b=h[e];for(f in b)for(c=b[f],a=0,d=c.length;d>a;a++)g=i.call(j,c[a]),g&&(a--,d--)}},getNearObject:function(h){var b,c,d,m,f,j,g,a,k=this._getCoord(h.x),l=this._getCoord(h.y),n=this._objectPoint,e=this._sqCellSize,i=null;for(b=l-1;l+1>=b;b++)if(m=this._grid[b])for(c=k-1;k+1>=c;c++)if(f=m[c])for(d=0,j=f.length;j>d;d++)g=f[d],a=this._sqDist(n[L.Util.stamp(g)],h),(e>a||e>=a&&null===i)&&(e=a,i=g);return i},_getCoord:function(a){var b=Math.floor(a/this._cellSize);return isFinite(b)?b:a},_sqDist:function(a,b){var c=b.x-a.x,d=b.y-a.y;return c*c+d*d}},function(){L.QuickHull={getDistant:function(b,a){var c=a[1].lat-a[0].lat,d=a[0].lng-a[1].lng;return d*(b.lat-a[0].lat)+c*(b.lng-a[0].lng)},findMostDistantPointFromBaseLine:function(h,e){var a,b,c,f=0,d=null,g=[];for(a=e.length-1;a>=0;a--)b=e[a],c=this.getDistant(b,h),c>0&&(g.push(b),c>f&&(f=c,d=b));return{maxPoint:d,newPoints:g}},buildConvexHull:function(b,d){var c=[],a=this.findMostDistantPointFromBaseLine(b,d);return a.maxPoint?(c=c.concat(this.buildConvexHull([b[0],a.maxPoint],a.newPoints)),c=c.concat(this.buildConvexHull([a.maxPoint,b[1]],a.newPoints))):[b[0]]},getConvexHull:function(f){var b,c=!1,d=!1,h=!1,i=!1,m=null,j=null,l=null,k=null,e=null,g=null,a,n;for(b=f.length-1;b>=0;b--)a=f[b],(c===!1||a.lat>c)&&(m=a,c=a.lat),(d===!1||a.lat<d)&&(j=a,d=a.lat),(h===!1||a.lng>h)&&(l=a,h=a.lng),(i===!1||a.lng<i)&&(k=a,i=a.lng);return d!==c?(g=j,e=m):(g=k,e=l),n=[].concat(this.buildConvexHull([g,e],f),this.buildConvexHull([e,g],f)),n}}}(),L.MarkerCluster.include({getConvexHull:function(){var b,a,c=this.getAllChildMarkers(),d=[];for(a=c.length-1;a>=0;a--)b=c[a].getLatLng(),d.push(b);return L.QuickHull.getConvexHull(d)}}),L.MarkerCluster.include({_2PI:2*Math.PI,_circleFootSeparation:25,_circleStartAngle:0,_spiralFootSeparation:28,_spiralLengthStart:11,_spiralLengthFactor:5,_circleSpiralSwitchover:9,spiderfy:function(){if(this._group._spiderfied!==this&&!this._group._inZoomAnimation){var b,a=this.getAllChildMarkers(null,!0),d=this._group,e=d._map,c=e.latLngToLayerPoint(this._latlng);this._group._unspiderfy(),this._group._spiderfied=this,a.length>=this._circleSpiralSwitchover?b=this._generatePointsSpiral(a.length,c):(c.y+=10,b=this._generatePointsCircle(a.length,c)),this._animationSpiderfy(a,b)}},unspiderfy:function(a){this._group._inZoomAnimation||(this._animationUnspiderfy(a),this._group._spiderfied=null)},_generatePointsCircle:function(b,f){var a,e,g=this._group.options.spiderfyDistanceMultiplier*this._circleFootSeparation*(2+b),c=g/this._2PI,h=this._2PI/b,d=[];for(c=Math.max(c,35),d.length=b,a=0;b>a;a++)e=this._circleStartAngle+a*h,d[a]=new L.Point(f.x+c*Math.cos(e),f.y+c*Math.sin(e))._round();return d},_generatePointsSpiral:function(d,g){var a,e=this._group.options.spiderfyDistanceMultiplier,c=e*this._spiralLengthStart,h=e*this._spiralFootSeparation,i=e*this._spiralLengthFactor*this._2PI,b=0,f=[];for(f.length=d,a=d;a>=0;a--)d>a&&(f[a]=new L.Point(g.x+c*Math.cos(b),g.y+c*Math.sin(b))._round()),b+=h/c+5e-4*a,c+=i/b;return f},_noanimationUnspiderfy:function(){var a,c,b=this._group,e=b._map,f=b._featureGroup,d=this.getAllChildMarkers(null,!0);for(b._ignoreMove=!0,this.setOpacity(1),c=d.length-1;c>=0;c--)a=d[c],f.removeLayer(a),a._preSpiderfyLatlng&&(a.setLatLng(a._preSpiderfyLatlng),delete a._preSpiderfyLatlng),a.setZIndexOffset&&a.setZIndexOffset(0),a._spiderLeg&&(e.removeLayer(a._spiderLeg),delete a._spiderLeg);b.fire("unspiderfied",{cluster:this,markers:d}),b._ignoreMove=!1,b._spiderfied=null}}),L.MarkerClusterNonAnimated=L.MarkerCluster.extend({_animationSpiderfy:function(f,h){var c,a,d,e,b=this._group,g=b._map,i=b._featureGroup,j=this._group.options.spiderLegPolylineOptions;for(b._ignoreMove=!0,c=0;c<f.length;c++)e=g.layerPointToLatLng(h[c]),a=f[c],d=new L.Polyline([this._latlng,e],j),g.addLayer(d),a._spiderLeg=d,a._preSpiderfyLatlng=a._latlng,a.setLatLng(e),a.setZIndexOffset&&a.setZIndexOffset(1e6),i.addLayer(a);this.setOpacity(.3),b._ignoreMove=!1,b.fire("spiderfied",{cluster:this,markers:f})},_animationUnspiderfy:function(){this._noanimationUnspiderfy()}}),L.MarkerCluster.include({_animationSpiderfy:function(g,n){var b,a,d,f,k,i,q=this,c=this._group,h=c._map,o=c._featureGroup,m=this._latlng,p=h.latLngToLayerPoint(m),l=L.Path.SVG,e=L.extend({},this._group.options.spiderLegPolylineOptions),j=e.opacity;for(void 0===j&&(j=L.MarkerClusterGroup.prototype.options.spiderLegPolylineOptions.opacity),l?(e.opacity=0,e.className=(e.className||"")+" leaflet-cluster-spider-leg"):e.opacity=j,c._ignoreMove=!0,b=0;b<g.length;b++)a=g[b],i=h.layerPointToLatLng(n[b]),d=new L.Polyline([m,i],e),h.addLayer(d),a._spiderLeg=d,l&&(f=d._path,k=f.getTotalLength()+.1,f.style.strokeDasharray=k,f.style.strokeDashoffset=k),a.setZIndexOffset&&a.setZIndexOffset(1e6),a.clusterHide&&a.clusterHide(),o.addLayer(a),a._setPos&&a._setPos(p);for(c._forceLayout(),c._animationStart(),b=g.length-1;b>=0;b--)i=h.layerPointToLatLng(n[b]),a=g[b],a._preSpiderfyLatlng=a._latlng,a.setLatLng(i),a.clusterShow&&a.clusterShow(),l&&(d=a._spiderLeg,f=d._path,f.style.strokeDashoffset=0,d.setStyle({opacity:j}));this.setOpacity(.3),c._ignoreMove=!1,setTimeout(function(){c._animationEnd(),c.fire("spiderfied",{cluster:q,markers:g})},200)},_animationUnspiderfy:function(h){var a,b,f,g,j,e,l=this,d=this._group,i=d._map,k=d._featureGroup,m=h?i._latLngToNewLayerPoint(this._latlng,h.zoom,h.center):i.latLngToLayerPoint(this._latlng),c=this.getAllChildMarkers(null,!0),n=L.Path.SVG;for(d._ignoreMove=!0,d._animationStart(),this.setOpacity(1),b=c.length-1;b>=0;b--)a=c[b],a._preSpiderfyLatlng&&(a.closePopup(),a.setLatLng(a._preSpiderfyLatlng),delete a._preSpiderfyLatlng,e=!0,a._setPos&&(a._setPos(m),e=!1),a.clusterHide&&(a.clusterHide(),e=!1),e&&k.removeLayer(a),n&&(f=a._spiderLeg,g=f._path,j=g.getTotalLength()+.1,g.style.strokeDashoffset=j,f.setStyle({opacity:0})));d._ignoreMove=!1,setTimeout(function(){var e=0;for(b=c.length-1;b>=0;b--)a=c[b],a._spiderLeg&&e++;for(b=c.length-1;b>=0;b--)a=c[b],a._spiderLeg&&(a.clusterShow&&a.clusterShow(),a.setZIndexOffset&&a.setZIndexOffset(0),e>1&&k.removeLayer(a),i.removeLayer(a._spiderLeg),delete a._spiderLeg);d._animationEnd(),d.fire("unspiderfied",{cluster:l,markers:c})},200)}}),L.MarkerClusterGroup.include({_spiderfied:null,unspiderfy:function(){this._unspiderfy.apply(this,arguments)},_spiderfierOnAdd:function(){this._map.on("click",this._unspiderfyWrapper,this),this._map.options.zoomAnimation&&this._map.on("zoomstart",this._unspiderfyZoomStart,this),this._map.on("zoomend",this._noanimationUnspiderfy,this),L.Browser.touch||this._map.getRenderer(this)},_spiderfierOnRemove:function(){this._map.off("click",this._unspiderfyWrapper,this),this._map.off("zoomstart",this._unspiderfyZoomStart,this),this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._map.off("zoomend",this._noanimationUnspiderfy,this),this._noanimationUnspiderfy()},_unspiderfyZoomStart:function(){this._map&&this._map.on("zoomanim",this._unspiderfyZoomAnim,this)},_unspiderfyZoomAnim:function(a){L.DomUtil.hasClass(this._map._mapPane,"leaflet-touching")||(this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._unspiderfy(a))},_unspiderfyWrapper:function(){this._unspiderfy()},_unspiderfy:function(a){this._spiderfied&&this._spiderfied.unspiderfy(a)},_noanimationUnspiderfy:function(){this._spiderfied&&this._spiderfied._noanimationUnspiderfy()},_unspiderfyLayer:function(a){a._spiderLeg&&(this._featureGroup.removeLayer(a),a.clusterShow&&a.clusterShow(),a.setZIndexOffset&&a.setZIndexOffset(0),this._map.removeLayer(a._spiderLeg),delete a._spiderLeg)}}),L.MarkerClusterGroup.include({refreshClusters:function(a){return a?a instanceof L.MarkerClusterGroup?a=a._topClusterLevel.getAllChildMarkers():a instanceof L.LayerGroup?a=a._layers:a instanceof L.MarkerCluster?a=a.getAllChildMarkers():a instanceof L.Marker&&(a=[a]):a=this._topClusterLevel.getAllChildMarkers(),this._flagParentsIconsNeedUpdate(a),this._refreshClustersIcons(),this.options.singleMarkerMode&&this._refreshSingleMarkerModeMarkers(a),this},_flagParentsIconsNeedUpdate:function(b){var c,a;for(c in b)for(a=b[c].__parent;a;)a._iconNeedsUpdate=!0,a=a.__parent},_refreshSingleMarkerModeMarkers:function(b){var c,a;for(c in b)a=b[c],this.hasLayer(a)&&a.setIcon(this._overrideMarkerIcon(a))}}),L.Marker.include({refreshIconOptions:function(b,c){var a=this.options.icon;return L.setOptions(a,b),this.setIcon(a),c&&this.__parent&&this.__parent._group.refreshClusters(this),this}}),a.MarkerClusterGroup=b,a.MarkerCluster=c})